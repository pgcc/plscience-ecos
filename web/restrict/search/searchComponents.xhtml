<ui:composition template="/WEB-INF/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">
        <h2 class="page-header">Search Components</h2>

        <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
        <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
            <p:graphicImage name="/images/ajax-loader.gif" />
        </p:dialog>

        <h:form id="searchComponentsForm">
            <p:growl id="growl" />
            <p:panel header="Search in Repositories" style="margin: 10px 0;">
                <p:messages id="messages" />
                <p:selectManyCheckbox id="basic" value="#{searchComponents.selectedComponents}">
                    <f:selectItem itemLabel="Files" itemValue="file"/>
                    <f:selectItem itemLabel="Packs" itemValue="pack" />
                    <f:selectItem itemLabel="Services" itemValue="service" />     
                    <f:selectItem itemLabel="Workflows" itemValue="workflow" />
                </p:selectManyCheckbox>                    
                <h:panelGrid columns="3" cellpadding="4">
                    <h:outputLabel for="searchTerm" value="Enter your search term: " />
                    <p:inputText id="searchTerm" 
                                 value="#{searchComponents.searchQuery}" 
                                 required="true" 
                                 label="SearchTerm"
                                 size="50">
                        <f:validateLength minimum="4" />
                    </p:inputText>
                    <p:message for="searchTerm" />    
                </h:panelGrid>

                <p:accordionPanel>                
                    <p:tab title="Prime Search - Syntactic">
                        <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="10">
                            <h:outputLabel for="hasAddress" value="Address: " />
                            <h:inputText id="hasAddress"
                                         value="#{searchComponents.serviceDescriptionVO.includesSyntactic.hasAddress}"/> 
                            <h:outputLabel for="hasReturn" value="Return:" />
                            <h:inputText 
                                id="hasReturn"
                                value="#{searchComponents.serviceDescriptionVO.includesSyntactic.hasReturn}"/>
                        </h:panelGrid>
                    </p:tab>
                    <p:tab title="Prime Search - Semantic">
                        <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="10">
                            <h:outputLabel for="hasSemanticReturn" value="Semantic Return" />
                            <h:inputText id="hasSemanticReturn"
                             value="#{searchComponents.serviceDescriptionVO.includesSemantic.hasSemanticReturn}"/>             
                            <h:outputLabel for="hasSemanticReception" value="Semantic Reception" />
                            <h:inputText id="hasSemanticReception"
                             value="#{searchComponents.serviceDescriptionVO.includesSemantic.hasSemanticReception}"/>
                            <h:outputLabel for="hasSemanticRepresentation" value="Semantic Representation" />
                            <h:inputText id="hasSemanticRepresentation"
                            value="#{searchComponents.serviceDescriptionVO.includesSemantic.hasSemanticRepresentation}"/>
                            <h:outputLabel for="hasFunctionalRequirement" value="Functional Requirement" />
                            <h:inputText id="hasFunctionalRequirement"
                            value="#{searchComponents.serviceDescriptionVO.includesSemantic.hasFunctionalRequirement}"/>
                        </h:panelGrid>
                    </p:tab>
                    <p:tab title="Prime Search - Pragmatic">
                        <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="10">
                            <h:outputLabel for="hasNonFunctionalReq" value="Non Functional Requirement" />
                            <h:inputText id="hasNonFunctionalReq"
                             value="#{searchComponents.serviceDescriptionVO.includesPragmatic.hasNonFunctionalReq}"/>
                            <h:outputLabel value="Context" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel value="" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel for="hasArtifact" value="Artifact" />
                            <h:inputText id="hasArtifact"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesContext.hasArtifact}"/>
                            <h:outputLabel for="hasDomain" value="Domain" />
                            <h:inputText id="hasDomain"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesContext.hasDomain}"/>
                            <h:outputLabel for="hasLicense" value="License" />
                            <h:inputText id="hasLicense"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesContext.hasLicense}"/>
                            <h:outputLabel for="hasComments" value="Comments" />
                            <h:inputText id="hasComments"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesContext.hasComments}"/>
                            <h:outputLabel for="how" value="Purpose" />
                            <h:inputText id="how"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesContext.how}"/>
                            <h:outputLabel for="where" value="Provider" />
                            <h:inputText id="where"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesContext.where}"/>
                            <h:outputLabel for="when" value="Publication Data" />
                            <h:inputText id="when"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesContext.when}"/>
                            <h:outputLabel for="who" value="Scientist Name" />
                            <h:inputText id="who"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesContext.who}"/>
                            <h:outputLabel for="hasRestriction" value="Restriction" />
                            <h:inputText id="hasRestriction"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesContext.hasRestriction}"/>
                            <h:outputLabel value="Hardware" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel value="" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel for="hasCPU" value="CPU"/>
                            <h:inputText id="hasCPU" value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesHardware.hasCPU}"/>
                            <h:outputLabel for="hasOperationalSystem" value="Operational System" />
                            <h:inputText id="hasOperationalSystem"
                            value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesHardware.hasOperationalSystem}"/>
                            <h:outputLabel for="hasRAM" value="RAM (GB)" />
                            <h:inputText id="hasRAM" value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesHardware.hasRAM}">
                                <f:validateRegex pattern="[0-9]*"/>
                            </h:inputText>
                            <h:outputLabel for="hasROM" value="ROM (GB)"/>
                            <h:inputText id="hasROM" value="#{searchComponents.serviceDescriptionVO.includesPragmatic.includesHardware.hasROM}">
                                <f:validateRegex pattern="[0-9]*"/>
                            </h:inputText>    
                        </h:panelGrid>
                    </p:tab>
                </p:accordionPanel>

                <p:commandButton value="Search" icon="ui-icon-search" 
                                 actionListener="#{searchComponents.search()}"
                                 update="searchResults"    />
            </p:panel>
            <p:panel header="Results" style="margin: 10px 0;">
                <p:dataTable var="result" value="#{searchComponents.patternResults}" 
                             id="searchResults" emptyMessage="No records found"
                             paginatorTemplate="{RowsPerPageDropdown} {CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                             paginator="true" rows="3" rowsPerPageTemplate="3,4,5,10,25,50,100,9999"
                             style="margin-top: 20px">
                    <p:column headerText="Component Name" sortBy="#{result.name}">
                        <h:outputText value="#{result.name}" />
                    </p:column>
                    <p:column headerText="Repository Name" sortBy="#{result.repositoryName}">
                        <h:outputText value="#{result.repositoryName}" />
                    </p:column>
                    <p:column headerText="Component Type" sortBy="#{result.componentType}">
                        <h:outputText value="#{result.componentType}" />
                    </p:column>                    
                    <p:column headerText="Description" sortBy="#{result.description}">
                        <h:outputText value="#{result.description.length() gt 100 ? result.description.substring(0,97).concat('...') : result.description}" title="#{result.description}"/>
                    </p:column>
                    <p:column headerText="Owner">
                        <h:outputText value="#{result.owner}"/>
                    </p:column>

                    <p:column headerText="Component Documentation" style="text-align: center">
                        <p:commandButton value="More Details" 
                                         actionListener="#{searchComponents.viewDetails(result)}"
                                         update=":searchComponentsForm:moreDetails"/>

                        <p:commandButton value="Download" ajax="false" icon="ui-icon-arrowthick-1-s">
                            <p:fileDownload value="#{result.createComponentFile(result)}" />
                        </p:commandButton>
                    </p:column>                    
                </p:dataTable>
            </p:panel>

            <p:panel header="Details">
                <p:dataList 
                    var="details" value="#{searchComponents.provenanceDetails}"
                    id="moreDetails" emptyMessage="No records found" >
                    <p:tabView orientation="left">
                        <p:tab title="Provenance Data">
                            <p:panelGrid columns="2">
                                <p:column>
                                    <h:outputText value="Component Name" style="font-weight: bold"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.name}" style="font-weight: bold"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="Used" style="font-weight: bold"/>                                    
                                </p:column>
                                <p:column>
                                    <p:dataList 
                                        var="usedProv" value="#{details.used}"
                                        id="usedProvList">
                                        <h:outputText value="#{usedProv}"/>
                                    </p:dataList>
                                </p:column>
                                <p:column>                                
                                    <h:outputText value="Was Informed By" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <p:dataList 
                                        var="wasInfProv" value="#{details.wasInformedBy}"
                                        id="wasInfProvList">
                                        <h:outputText value="#{wasInfProv}"/>
                                    </p:dataList>
                                </p:column>
                                <p:column>
                                    <h:outputText value="Was Associated With" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <p:dataList 
                                        var="wasAssocWith" value="#{details.wasAssociatedWith}"
                                        id="wasAssocWithList">
                                        <h:outputText value="#{wasAssocWith}"/>
                                    </p:dataList>
                                </p:column>
                                <p:column>
                                    <h:outputText value="Acted Behalf Of" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <p:dataList 
                                        var="actBehOf" value="#{details.actedBehalfOf}"
                                        id="actBehOfList">
                                        <h:outputText value="#{actBehOf}"/>
                                    </p:dataList>                                
                                </p:column>
                                <p:column>
                                    <h:outputText value="Was Ended By:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <p:dataList 
                                        var="wasEndB" value="#{details.wasEndedBy}"
                                        id="wasEndBList">
                                        <h:outputText value="#{wasEndB}"/>
                                    </p:dataList>                                
                                </p:column>
                                <!--                                <p:column>
                                                                <h:outputText value="Ontology Evolution Inferences (Tasks):" style="font-weight: bold"/>
                                                                </p:column>
                                                                <p:column>
                                                                <p:dataList 
                                                                    var="evolTaskOnt" value="#{details.evolutionTaskOntology}"
                                                                    id="evolTaskOntList">
                                                                    <h:outputText value="#{evolTaskOnt}"/>
                                                                </p:dataList>                                
                                                                    </p:column>                                -->

                            </p:panelGrid>
                        </p:tab>
                        <p:tab title="Meta Data">
                            <p:panelGrid columns="2">
                                <p:column>
                                    <h:outputText value="Owner" style="font-weight: bold"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.owner} "/>
                                    <h:graphicImage value="#{details.resPatF.ownerCountryFlagImage}" />                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="Owner Country" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.ownerCountry}"/>                                    
                                </p:column>    
                                <p:column>
                                    <h:outputText value="Owner City" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.ownerCity}"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="Component Created At:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.createdAt}"/>
                                </p:column>                                
                                <p:column>
                                    <h:outputText value="Component Updated At:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.updatedAt}"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="Component Archived At:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.archivedAt}"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="Monitoring Status:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.monitoringStatusLabel}"/>                                    
                                </p:column> 
                                <p:column>
                                    <h:outputText value="Last Checked:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.monitoringStatusLastChecked}"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="License Type:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.licenseType}"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="PRIME - Return:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.returnPrimeSin}"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="PRIME - Semantic Return:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.returnPrimeSem}"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="PRIME - Semantic Reception:" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.receptionPrimeSem}"/>                                    
                                </p:column> 
                                <p:column>
                                    <h:outputText value="PRIME - Semantic Representation" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.representationPrimeSem}"/>                                    
                                </p:column>
                                <p:column>
                                    <h:outputText value="PRIME - Functional Requirements" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{details.resPatF.functionalRequirementPrimeSem}"/>                                    
                                </p:column>                                
                            </p:panelGrid>                            
                        </p:tab>
                        <p:tab title="Service Semantic Annotation">
                            <p:dataTable var="task" value="#{details.serviceOperations}">
                                <p:column headerText="Name">
                                    <h:outputText value="#{task.name}" />
                                </p:column>

                                <p:column headerText="Inputs">
                                    <p:dataTable var="resultInputs" value="#{task.inputs}" id="inp" 
                                                 emptyMessage="No records found">
                                        <p:column headerText="WSDL Parameter" width="30%">
                                            <h:outputText value="#{details.getShortNameParameter(resultInputs)}" title="#{details.getShortNameParameter(resultInputs)}"/>
                                        </p:column> 
                                        <p:column headerText="WSDL Type" width="30%">
                                            <h:outputText value="#{details.getShortTypeParameter(resultInputs)}" title="#{details.getShortTypeParameter(resultInputs)}"/>
                                        </p:column>                             
                                    </p:dataTable>
                                </p:column>

                                <p:column headerText="Outputs">
                                    <p:dataTable var="resultOutputs" value="#{task.outputs}" id="out" 
                                                 emptyMessage="No records found">
                                        <p:column headerText="WSDL Parameter" width="30%">
                                            <h:outputText value="#{details.getShortNameParameter(resultOutputs)}" title="#{details.getShortNameParameter(resultOutputs)}"/>
                                        </p:column> 
                                        <p:column headerText="WSDL Type" width="30%">
                                            <h:outputText value="#{details.getShortTypeParameter(resultOutputs)}" title="#{details.getShortTypeParameter(resultOutputs)}"/>
                                        </p:column>                             
                                    </p:dataTable>
                                </p:column>                                
                                <p:column headerText="Service Annotation">
                                    <p:commandButton value="Generate OWL-S" action="#{details.semanticAnnotation(task,details)}"/>
                                </p:column>
                            </p:dataTable>                               
                        </p:tab>                        
                    </p:tabView>
                </p:dataList>
            </p:panel>            

        </h:form>
    </ui:define>
</ui:composition>