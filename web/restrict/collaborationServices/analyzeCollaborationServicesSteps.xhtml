<ui:composition template="/WEB-INF/templates/layout.xhtml"
     xmlns="http://www.w3.org/1999/xhtml"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">
        <h2 class="page-header">Analyze Collaboration Services</h2>
        
        <p:tabView>
            <p:ajax event="tabChange" listener="#{analyzeCollaborationServiceBean.chooseService}" update="tabStep2"/>
            <p:tab id="tabStep1" title="Step 1 - PRIME">
            <h:form id="searchPage">
                             
                <p:commandButton id="serviceCollabBtn" value="Search Colaboration Service" icon="ui-icon-search" />

                <p:overlayPanel id="serviceCollabPanel" for="serviceCollabBtn" hideEffect="fade" dynamic="true" style="width:600px">
                    <h:form id="searchPanel">
                        <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="10">
                            <h:outputLabel value="Syntactic" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel value="" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel for="hasAddress" value="Address" />
                            <h:inputText id="hasAddress" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesSyntactic.hasAddress}" />
                            <h:outputLabel for="hasReturn" value="Return:" />
                            <h:inputText id="hasReturn" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesSyntactic.hasReturn}" />

                            <h:outputLabel value="Semantic" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel value="" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel for="hasSemanticReturn" value="Semantic Return" />
                            <h:inputText id="hasSemanticReturn" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesSemantic.hasSemanticReturn}" />             
                            <h:outputLabel for="hasSemanticReception" value="Semantic Reception" />
                            <h:inputText id="hasSemanticReception" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesSemantic.hasSemanticReception}" />
                            <h:outputLabel for="hasSemanticRepresentation" value="Semantic Representation" />
                            <h:inputText id="hasSemanticRepresentation" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesSemantic.hasSemanticRepresentation}" />
                            <h:outputLabel for="hasFunctionalRequirement" value="Functional Requirement" />
                            <h:inputText id="hasFunctionalRequirement" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesSemantic.hasFunctionalRequirement}" />

                            <h:outputLabel value="Pragmatic" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel value="" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel for="hasNonFunctionalReq" value="Non Functional Requirement" />
                            <h:inputText id="hasNonFunctionalReq" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.hasNonFunctionalReq}" />
                            <h:outputLabel value="Context" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel value="" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel for="hasArtifact" value="Artifact" />
                            <h:inputText id="hasArtifact" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesContext.hasArtifact}" />
                            <h:outputLabel for="hasDomain" value="Domain" />
                            <h:inputText id="hasDomain" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesContext.hasDomain}" />
                            <h:outputLabel for="hasLicense" value="License" />
                            <h:inputText id="hasLicense" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesContext.hasLicense}" />
                            <h:outputLabel for="hasComments" value="Comments" />
                            <h:inputText id="hasComments" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesContext.hasComments}" />

                            <h:outputLabel for="how" value="Purpose" />
                            <h:inputText id="how" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesContext.how}" />
                            <h:outputLabel for="where" value="Provider" />
                            <h:inputText id="where" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesContext.where}" />
                            <h:outputLabel for="when" value="Publication Data" />
                            <h:inputText id="when" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesContext.when}" />
                            <h:outputLabel for="who" value="Scientist Name" />
                            <h:inputText id="who" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesContext.who}" />
                            <h:outputLabel for="hasRestriction" value="Restriction" />
                            <h:inputText id="hasRestriction" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesContext.hasRestriction}" />
                            <h:outputLabel value="Hardware" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel value="" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                            <h:outputLabel for="hasCPU" value="CPU" />
                            <h:inputText id="hasCPU" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesHardware.hasCPU}" />
                            <h:outputLabel for="hasOperationalSystem" value="Operational System" />
                            <h:inputText id="hasOperationalSystem" value="#{experimentPrototyping.serviceDescriptionVO.includesPragmatic.includesHardware.hasOperationalSystem}" />
                            <h:outputLabel for="hasRAM" value="RAM (GB)" />
                            <h:inputText id="hasRAM" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesHardware.hasRAM}">
                                <f:validateRegex pattern="[0-9]*"/>
                            </h:inputText>
                            <h:outputLabel for="hasROM" value="ROM (GB)" />
                            <h:inputText id="hasROM" value="#{analyzeCollaborationServiceBean.serviceDescriptionVO.includesPragmatic.includesHardware.hasROM}">
                               <f:validateRegex pattern="[0-9]*"/>
                            </h:inputText>  
                        </h:panelGrid>
                        <h:commandButton id="btnE" value="Find Collaboration Service" type="submit" action="#{analyzeCollaborationServiceBean.searchServices()}"/>
                    </h:form>
                </p:overlayPanel>

                <p:dataTable var="serviceUsed" value="#{analyzeCollaborationServiceBean.services}" id="servicesResult" style="margin-top: 20px" >
                    <p:column headerText="Services Ranking">
                        <h:outputText value="#{serviceUsed.name} (#{serviceUsed.includesSemantic.hasSemanticReturn})" />
                    </p:column>
                    <p:column>
                    <p:commandButton value="View Details" id="viewDetails"/>
                        <p:overlayPanel id="viewDetailsPanel" for="viewDetails" hideEffect="fade" dynamic="true" style="width:600px">
                            <h:form id="viewDetailsForm">
                                <h:outputLabel value="Service Details" for="serviceDescriptionVO" styleClass="panelGridLabel"/>
                                <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="10">
                                    <h:outputLabel for="hasAddress" value="Address" />
                                    <h:outputText id="hasAddress" value="#{serviceUsed.includesSyntactic.hasAddress}" />
                                    <h:outputLabel for="hasReturn" value="Return" />
                                    <h:outputText id="hasReturn" value="#{serviceUsed.includesSyntactic.hasReturn}" />
                                    <h:outputLabel for="hasComments" value="Description" />
                                    <h:outputText id="hasComments" value="#{serviceUsed.includesPragmatic.includesContext.hasComments}" />
                                </h:panelGrid>
                            </h:form>
                        </p:overlayPanel>
                    </p:column>
                    <p:column>
                        <p:commandButton title="select Service" 
                                         value="Select Service" >
                            <f:setPropertyActionListener value="#{serviceUsed}" target="#{analyzeCollaborationServiceBean.serviceUsed}" for="collabService1" />
                            <p:confirm header="Select Service" message="Select Service?" icon="ui-icon-alert" />
                        </p:commandButton>
                        
                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton value="Yes" 
                                             type="button" 
                                             styleClass="ui-confirmdialog-yes" 
                                             icon="ui-icon-check" 
                                             actionListener="#{analyzeCollaborationServiceBean.chooseService}" />
                        </p:confirmDialog>
                    </p:column>
                </p:dataTable>

            </h:form>                   
            </p:tab>
            
            <p:tab id="tabStep2" title="Step 2 - VALIDATION" >   
                <h:form id="newCollaborationServiceForm">
                    <p:growl id="growl" />
                    <p:panel id="panelAnalyze" header="Analyze" style="margin: 10px 0;">
                        <p:messages id="messages" />                    
                        <h:panelGrid id="panelGridAli" columns="2" cellpadding="4">
                            <h:outputLabel for="collabService1" value="Selected Collaboration Service: " rendered="#{analyzeCollaborationServiceBean.isShow()}"/>
                            <h:inputText id="collabService1" value="#{analyzeCollaborationServiceBean.collaborationService1.collabServiceName}" 
                                         disabled="true" rendered="#{analyzeCollaborationServiceBean.isShow()}" >                                
                            </h:inputText>

                            <ui:remove>
                            <p:selectOneMenu id="collabService1" value="#{analyzeCollaborationServiceBean.collaborationService1}" 
                                             converter="collabServiceConverter" 
                                             panelStyle="width:200px"
                                             effect="fade" var="c" style="width:450px" filter="true" filterMatchMode="startsWith"
                                             rendered="#{analyzeCollaborationServiceBean.isShow()}">
                                <f:selectItems value="#{analyzeCollaborationServiceBean.collaborationServiceList}" var="collaborationService" 
                                               itemLabel="#{collaborationService.collabServiceName}" itemValue="#{collaborationService}" />

                                <p:column>
                                    <h:outputText value="#{c.id}" />
                                </p:column>

                                <p:column>
                                    <h:outputText value="#{c.collabServiceName}" />
                                </p:column>

                            </p:selectOneMenu>
                            </ui:remove>

                            <h:outputLabel for="collabService2" value="Instance's Collaboration Service: " rendered="#{analyzeCollaborationServiceBean.isShow()}" />
                            <p:selectOneMenu id="collabService2" value="#{analyzeCollaborationServiceBean.collaborationService2}" 
                                             converter="collabServiceConverter" 
                                             panelStyle="width:200px"
                                             effect="fade" var="d" style="width:450px" filter="true" filterMatchMode="startsWith"
                                             rendered="#{analyzeCollaborationServiceBean.isShow()}">
                                <f:selectItems value="#{analyzeCollaborationServiceBean.collaborationServiceList}" var="collaborationService" 
                                               itemLabel="#{collaborationService.collabServiceName}" itemValue="#{collaborationService}" />

                                <p:column headerText="Name">
                                    <h:outputText value="#{d.collabServiceName}" />
                                </p:column>
                            </p:selectOneMenu>

                            <p:commandButton id="analizeBtn" value="Analize" icon="ui-icon-check" style="margin:0" 
                                             actionListener="#{analyzeCollaborationServiceBean.analyzeCollabServices()}" 
                                             type="submit" update="newCollaborationServiceForm"
                                             rendered="#{analyzeCollaborationServiceBean.isShow()}"/>
                        </h:panelGrid>

                        <p:accordionPanel rendered="#{!analyzeCollaborationServiceBean.isShow()}">
                            <p:tab title="STRUCTURAL RESULT">

                                <h:outputText value="#{analyzeCollaborationServiceBean.statusCompare}" escape="false" />

                                <h:panelGrid columns="1" cellpadding="4">

                                    <p:dataTable id="tabSameConcepts"
                                             var="sameCon" 
                                             value="#{analyzeCollaborationServiceBean.interoperabilityServices.sameConcept}"
                                             emptyMessage="No concepts found."
                                             style="table-layout: fixed"
                                             rendered="#{!analyzeCollaborationServiceBean.isShow()}">                            
                                        <p:column headerText="Same Concepts Table"> 
                                            <h:outputText value="#{sameCon}" />
                                        </p:column>                 
                                    </p:dataTable>

                                    <p:dataTable id="tabDifferentConcepts"
                                             var="differentCon" 
                                             value="#{analyzeCollaborationServiceBean.interoperabilityServices.differentConcept}"
                                             emptyMessage="No concepts found." 
                                             style="table-layout: fixed"
                                             rendered="#{!analyzeCollaborationServiceBean.isShow()}">
                                        <p:column headerText="Different Concepts Table"> 
                                            <h:outputText value="#{differentCon}" />
                                        </p:column>                 
                                    </p:dataTable>
                                </h:panelGrid>
                            </p:tab>

                            <p:tab title="ALIGNMENT RESULT">
                                <p:dataTable id="tabConcepts"
                                            var="con" 
                                            value="#{analyzeCollaborationServiceBean.interoperabilityServices.interoperabilityStructXML.concepts}"
                                            emptyMessage="No match found."
                                            rendered="#{!analyzeCollaborationServiceBean.isShow()}">
                                    <f:facet name="header">Matching Table</f:facet>
                                    <p:column headerText="Group Concept"> 
                                        <h:outputText value="#{con.groupConcept}" />
                                    </p:column>
                                    <p:column headerText="Concept"> 
                                        <h:outputText value="#{con.conceptService}" />
                                    </p:column>
                                    <p:column headerText="Has Element?"> 
                                        <h:outputText value="#{con.hasElement}" />
                                    </p:column>
                                    <p:column headerText="Element Service 1"> 
                                        <h:outputLink id="linkS1" value="#">
                                            <h:outputText value="#{con.conceptService1}" />   
                                        </h:outputLink>
                                        <p:tooltip id="trackS1" for="linkS1" value="#{con.descriptionService1}" 
                                                   trackMouse="true" rendered="#{con.conceptService1 != null}" />
                                    </p:column>
                                    <p:column headerText="Element Service 2"> 
                                        <h:outputLink id="linkS2" value="#">
                                            <h:outputText value="#{con.conceptService2}" />
                                        </h:outputLink>
                                        <p:tooltip id="trackS2" for="linkS2" value="#{con.descriptionService2}" 
                                                   trackMouse="true" rendered="#{con.conceptService2 != null}" /> 
                                    </p:column>
                                    <p:column headerText="Ratio"> 
                                        <h:outputText value="#{con.ratio}" style="font-weight:bold; color:green" rendered="#{con.ratio.doubleValue() ge 60}" />
                                        <h:outputText value="#{con.ratio}" style="font-weight:bold; color:red" rendered="#{con.ratio.doubleValue() lt 60}" />                                        
                                    </p:column>                                 
                                    <p:column headerText="Validity?"> 
                                        <h:outputText value="#{con.validity}" style="font-weight:bold; color:green" 
                                                      rendered="#{con.validity == true and (con.note == null or con.note.length() == 0)}" />
                                        <h:outputText value="#{con.validity}" style="font-weight:bold; color:red" 
                                                      rendered="#{con.validity == false and (con.note == null or con.note.length() == 0)}" />

                                        <h:outputLink id="linkNote" value="#" rendered="#{con.note != null and con.note.length() != 0}">
                                            <h:outputText value="#{con.validity}" style="font-weight:bold; color:green" rendered="#{con.validity == true}" />
                                            <h:outputText value="#{con.validity}" style="font-weight:bold; color:red" rendered="#{con.validity == false}" />
                                        </h:outputLink>
                                        <p:tooltip id="trackNote" for="linkNote" value="#{con.note}" 
                                                   trackMouse="true" rendered="#{con.conceptService2 != null}" />
                                    </p:column>
                                    <p:column headerText="Action">
                                        <center>
                                        <p:commandButton icon="ui-icon-pencil" value="Validity" onclick="PF('Edit').show();"> 
                                            <f:setPropertyActionListener target="#{analyzeCollaborationServiceBean.conceptXML}"
                                                                         value="#{con}" />
                                        </p:commandButton>
                                        </center>
                                    </p:column> 
                                </p:dataTable>

                                <p:dialog header="Validity" widgetVar="Edit" modal="true" 
                                    id="Edit" rendered="#{!analyzeCollaborationServiceBean.isShow()}">
                                    <p:panelGrid id="panelAlterar" columns="2">                                      
                                        <p:outputLabel for="validity" value="Validity? " />
                                        <p:selectBooleanButton id="validity" value="#{analyzeCollaborationServiceBean.conceptXML.validity}" 
                                                               onLabel="Yes" offLabel="No" style="width:60px" />
                                        <h:outputText value="Note: " />
                                        <p:inputText value="#{analyzeCollaborationServiceBean.conceptXML.note}" />
                                    </p:panelGrid>
                                    <BR/>
                                    <center>
                                    <p:commandButton value="Save"  
                                                     icon="ui-icon-disk" 
                                                     actionListener="#{analyzeCollaborationServiceBean.editConcept}" 
                                                     onclick="Edit.hide()" 
                                                     onfocus="tabStep2"
                                                     alt="Edit"
                                                     update="tabConcepts" />
                                    </center>
                                </p:dialog>
                            </p:tab>
                        </p:accordionPanel>                               

                        <BR/>
                        <h:panelGrid columns="2" cellpadding="4" >
                            <p:commandButton id="saveBtn" value="Finish" icon="ui-icon-check" style="margin:0" actionListener="#{analyzeCollaborationServiceBean.finish()}" rendered="#{!analyzeCollaborationServiceBean.isShow()}" />
                            <p:commandButton id="cancelBtn" value="Cancel" icon="ui-icon-cancel" style="margin:0" actionListener="#{analyzeCollaborationServiceBean.cancel()}" />
                        </h:panelGrid>

                    </p:panel>
                </h:form>
            </p:tab>
        </p:tabView>    
    </ui:define>
</ui:composition>